IT자산장부
사내 IT 자산 대여·반납·검수·반납관리 프로세스 DB 설계

1. 프로젝트 개요
사내 IT 자산(노트북/모니터/태블릿/모바일 단말 등)의 자산 등록 → 대여/출고 → 반납 요청 → 반납/검수 → (수리 여부 판정) → 가용 복귀/수리 처리 전 과정을 단일 데이터 모델로 관리한다.
본 프로젝트는 “정산(연체료/수리비/보증금 차감·환급)” 기능을 범위에서 제외하고, 반납관리(반납 요구/경고/제재) 이력 기반 통제로 미반납/지연 반납을 구조적으로 줄이는 것을 목표로 한다.
목적은 아래 항목을 이력 기반으로 재현 가능하게 만드는 것이다.
- 누가 어떤 자산을 언제부터 사용했는지
- 반납 검수 결과와 증빙(사진/파일/메모)이 무엇인지
- 반납예정일 경과 시 반납 요구/경고/제재가 언제 어떤 근거로 발생했는지

2. 서비스 목표
- 자산 라이프사이클 표준화: 등록/할당/출고/반납요청/검수/수리/가용복귀 상태 전이를 데이터로 강제
- 미반납 통제: 반납예정일(due_date) 경과 기반의 요구/경고/제재를 이력으로 남겨 운영 누락을 방지
- 운영 리스크 감소: 분실/중복 지급/재고 불일치 및 담당자 주관 판단(검수 기준 불일치) 최소화
- 근거 기반 이력 추적: 검수 결과, 증빙, 메시지(요구/경고), 제재 이력의 참조 관계를 유지

3. 사용자(역할) 정의
- 임차사 담당자(사용자): 자산 수령/사용, 반납요청 생성, 반납 진행
- 자산관리자(고객사): 자산 등록/상태 관리, 반납 회수 처리, 검수 및 증빙 등록, 수리 처리
- 렌탈 담당자(옵션): 계약/대여 승인(승인 단계가 필요한 경우에만 포함)
- 운영 관리자(정책): 반납관리 정책(요구/경고/제재 기준) 설정 및 운영 모니터링

4. 업무 범위(MVP) 및 제외 범위
MVP 포함 범위
- 자산 마스터 등록 및 상태 관리
- 사용자/부서/프로젝트(또는 비용센터) 기반 할당 및 출고(대여)
- 반납요청 및 회수, 검수 기록, 증빙 첨부(사진/파일/메모)
- 수리 필요 판정 및 수리 진행 이력(수리비 산정은 제외)
- due_date 기반 반납관리(요구/경고/제재) 이력 관리
- 요구사항명세서 ID는 “기능 중심 slug”로 관리(예: asset_list, return_request_create)

제외 범위(명시)
- 연체료/수리비/보증금 환급·차감 등 금액 산정 및 정산 기능 전부
- 회계/세무 연계, 결제/청구 연계
- 외부 솔루션(메신저/메일) 실연동(필요 시 이벤트 로그까지만 설계)
- 조달(PO/배송/입고) 프로세스(현재 기획서 범위 외)

5. 핵심 용어 및 코드 통일
용어 통일(핵심)
- due_date: 반납예정일(계약 또는 출고 기준으로 계산된 반납 기한)
- return_request: 반납요청(사용자가 반납 의사를 등록한 이벤트)
- inspection: 반납검수(회수 후 상태 확인 및 증빙 등록)
- repair_required: 검수 결과 수리 필요 여부(Y/N). 상태 코드가 아니라 검수 결과 속성이다.
- overdue_count: 미반납 누적 횟수. 사용자(임차사 담당자) 단위로 누적한다.
- warning_count: 경고 메시지 발생 누적 횟수. 사용자(임차사 담당자) 단위로 누적한다.
- restriction_level: 제재 단계(정책 값). 사용자(임차사 담당자) 단위로 관리한다.

요구사항 ID 규칙(기능 중심)
- 형식: <domain>_<action>[_detail]
- 예시: auth_sign_up, asset_list, asset_detail, return_request_create, inspect_evidence_attach
- 원칙: 의미 없는 번호형(ID_001 등) 금지, 동사 기반, 1요구사항=1ID(중복 의미 금지)

요구사항 ID(요약 목록)
회원/인증(옵션)
- auth_sign_up, auth_terms_agree, auth_sign_in, auth_role_select, auth_sign_out, auth_profile_update, auth_password_reset

자산 조회
- asset_list, asset_detail

대여/출고
- lend_contract_create(옵션), asset_assign, asset_checkout, lend_due_date_set_update

반납/검수/수리
- return_request_create, return_request_cancel_retry, return_collect
- inspect_create, inspect_evidence_attach
- repair_start, repair_complete

반납관리(정책/시스템)
- policy_return_rules_upsert
- monitor_lent_assets, check_due_date_overdue, notice_generate_request, notice_generate_warning
- penalty_overdue_count_increment, restrict_apply_or_release, close_monitoring_on_return_complete
- notice_inbox_view

조회/리포트(옵션)
- history_timeline_view
- report_asset_status_summary, report_return_policy_summary, report_inspect_repair_summary

상태 코드 통일(자산 상태: 단일 세트로 고정)
라벨            DB 코드              정의
가용            AVAILABLE            대여 가능
할당됨          ASSIGNED             사용자/계약에 배정(출고 전)
대여중(출고)     OUT                  물리 출고 완료, 사용 중
반납요청         RETURN_REQUESTED     반납요청 등록(회수 대기)
검수중          INSPECTING           회수 완료, 검수 진행
수리중          UNDER_REPAIR         수리 진행
폐기            DISPOSED             폐기 확정(종결 상태)

상태 전이 원칙(요약)
- OUT → RETURN_REQUESTED → INSPECTING → (AVAILABLE 또는 UNDER_REPAIR) → AVAILABLE
- repair_required=Y인 경우에만 UNDER_REPAIR로 전환한다(“REPAIR_REQUIRED” 같은 별도 상태값은 사용하지 않는다).

6. 핵심 프로세스(요약, 요구사항 ID 매핑)
1) 자산 등록(asset_create / asset_identifier_register)
- 자산관리자가 자산 마스터(분류/식별자/스펙/상태=AVAILABLE)를 등록한다.
- 자산번호/시리얼/태그 등 식별값의 중복을 방지한다.

2) 할당 및 출고(대여)(asset_assign / asset_checkout / lend_due_date_set_update)
- 자산관리자가 임차사 담당자에게 자산을 할당(ASSIGNED)한다.
- 실제 지급 시 출고 처리(OUT) 및 due_date를 확정한다.
- due_date 변경은 변경 전/후/사유/처리자 이력으로 남긴다.

3) 자산 조회(asset_list / asset_detail)
- 사용자는 자산 목록 및 상세를 조회한다.
- 상태는 단일 상태코드(AVAILABLE/ASSIGNED/OUT/RETURN_REQUESTED/INSPECTING/UNDER_REPAIR/DISPOSED)로만 표기한다.

4) 반납요청(return_request_create / return_request_cancel_retry)
- 임차사 담당자가 반납요청(RETURN_REQUESTED)을 등록한다.
- 반납요청은 회수 전 단계이며, 취소/재요청 등 변동은 이벤트(이력)로 남긴다.
- 회수/검수 진행 이후 취소 가능 여부는 정책으로 제한한다.

5) 회수 및 검수(return_collect / inspect_create / inspect_evidence_attach)
- 자산관리자가 회수 처리 후 검수(INSPECTING)를 등록한다.
- 검수 결과로 repair_required(Y/N)와 증빙(사진/파일/메모)을 다건 등록한다.
- repair_required=N이면 상태를 AVAILABLE로 복귀한다.
- repair_required=Y이면 상태를 UNDER_REPAIR로 전환하고 수리 처리 이력을 생성한다.

6) 수리 및 가용 복귀(repair_start / repair_complete)
- 수리 완료 시 상태를 AVAILABLE로 복귀한다.
- 수리는 “진행/완료” 이력만 관리하고 비용 산정은 하지 않는다.

7. 반납관리 정책(요구/경고/제재, 요구사항 ID 매핑)
기본 개념
- 반납관리 이벤트는 “기한(due_date) 경과”를 트리거로 발생하며, 메시지/제재는 모두 이력 테이블로 남긴다.
- 근거 데이터 고정: overdue_count, warning_count, restriction_level 등은 이벤트 발생 시점 값을 함께 저장한다(사후 변경으로 근거가 바뀌는 문제 방지).

정책 설정(policy_return_rules_upsert)
- due_date 경과 기준(요구/경고/제재) 규칙을 테이블로 관리한다.

시스템 모니터링(monitor_lent_assets / check_due_date_overdue / close_monitoring_on_return_complete)
- OUT/ASSIGNED 상태 자산을 모니터링 대상으로 관리한다.
- 현재일 기준 due_date 경과 여부를 계산한다.
- 반납 완료(검수 완료 포함) 시 모니터링을 종료한다.

알림 로그 생성(notice_generate_request / notice_generate_warning / notice_inbox_view)
- 정책 조건 충족 시 요구/경고 메시지 로그를 생성한다.
- 사용자는 반납요구/경고/제재 메시지를 조회한다.

누적 및 제재(penalty_overdue_count_increment / restrict_apply_or_release)
- 정책에 따라 overdue_count/warning_count를 증가시키고, restriction_level을 상승/해제한다.
- 요구/경고 누락 상태에서 제재 상승을 금지한다(정책 예외가 있으면 플래그로 기록).

누적 규칙(고정)
- overdue_count는 사용자 단위로 누적한다.
- “기한 내 반납 완료”는 overdue_count를 증가시키지 않는다.
- “반납요청만 하고 회수/검수 완료가 지연”된 경우는 정책에 따라 overdue로 처리할 수 있으며, 기준은 정책 테이블에 둔다.

8. 데이터 설계 원칙(감점 포인트 방지)
- 상태 역전 방지: 검수 없이 AVAILABLE 복귀 금지, 수리 이력 없이 UNDER_REPAIR 전환 금지
- 제재 근거 누락 방지: 요구/경고 로그 없이 제재 상승 금지(정책상 예외는 플래그로 기록)
- 증빙 분리: 검수 증빙(사진/파일/메모)은 별도 엔터티로 다건 첨부 가능하게 설계
- 이력 우선: 요청/회수/검수/수리/요구/경고/제재는 모두 이벤트(이력)로 관리하고, 현재 상태는 스냅샷으로 유지
- 코드/용어 단일화: 문서/요구사항/ERD/SQL 전 구간 동일 코드 사용(혼용 금지)

9. 주요 엔터티(테이블) 범위(초안, 요구사항 ID 정합)
마스터
- asset(자산), asset_category(자산분류)
- user(임차사 담당자), department(부서/조직), role(권한)

업무(트랜잭션)
- rental_contract(옵션: lend_contract_create가 필요한 경우)
- asset_assignment(할당 이력: asset_assign)
- checkout_log(출고 이력: asset_checkout, lend_due_date_set_update 포함 가능)
- return_request(반납요청: return_request_create / return_request_cancel_retry)
- inspection(검수: inspect_create), inspection_evidence(검수 증빙: inspect_evidence_attach)
- repair(수리 이력: repair_start / repair_complete)

반납관리(정책/이력)
- return_policy(정책: policy_return_rules_upsert)
- monitor_log(모니터링 로그: monitor_lent_assets / close_monitoring_on_return_complete)
- notice_log(요구/경고 로그: notice_generate_request / notice_generate_warning)
- restriction_log(제재 로그: restrict_apply_or_release)
- user_penalty_status(사용자 누적 스냅샷: penalty_overdue_count_increment 등에서 갱신)

조회/리포트(옵션)
- history_view(또는 통합 조회 쿼리/뷰): history_timeline_view
- report_*: report_asset_status_summary / report_return_policy_summary / report_inspect_repair_summary

10. 테스트 관점(요약)
정상 플로우
- AVAILABLE → ASSIGNED → OUT → RETURN_REQUESTED → INSPECTING → AVAILABLE
수리 플로우
- INSPECTING(repair_required=Y) → UNDER_REPAIR → AVAILABLE
반납관리 플로우
- due_date 경과 시 요구/경고/제재 로그가 생성되고, 근거값이 로그에 고정되는지 검증
무결성 검증(차단 케이스)
- inspect_create 없이 AVAILABLE 복귀 시도 차단
- repair_start/repair 이력 없이 UNDER_REPAIR 전환 시도 차단
- notice_generate_request/notice_generate_warning 없이 restrict_apply_or_release로 제재 상승 시도 차단(정책 예외 없는 경우)

11. 산출물(계획)
1) 프로젝트 주제 선정
2) 프로젝트 개요
3) 프로젝트 기획서 제작
4) 프로젝트 시나리오 / 유스케이스 구성
5) 요구사항명세서 제작(기능 중심 ID 적용)
6) ERD 제작
7) 테이블 명세서 제작
8) SQL 산출물(DDL/프로시저·트리거) 작성
9) 테스트 케이스 및 결과 정리
